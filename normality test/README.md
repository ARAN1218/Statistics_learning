# normality test
各種正規性の検定について、自力による実装を通じて理解を深める目的でプログラムを公開します。
また、各種手法について自己理解の促進目的でREADMEにて簡単な解説を公開します。

# 各種正規性の検定手法のサマリー
| 検定手法 (Test Name) | 主な目的 (Primary Purpose) | 評価の着眼点 (Evaluation Approach) | 検定統計量 (Test Statistic) | 強み・特徴 (Strengths / Characteristics) | 注意点・弱み (Weaknesses / Points to Note) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **歪度によるダゴスティーノ検定** | 正規性の検定（**歪み**に特化） | **モーメント法**：分布の左右の非対称性（歪度）が統計的に0か評価する。 | $Z_1$ （標準正規分布に従う） | 分布が正規分布から外れる原因が「歪み」であることを特定できる。 | 尖度の異常は検出できない。 |
| **尖度による検定 (Anscombe-Glynn)** | 正規性の検定（**尖り**に特化） | **モーメント法**：分布の尖り具合（尖度）が正規分布（尖度3）と同じか評価する。 | $Z_2$ （標準正規分布に従う） | 分布が正規分布から外れる原因が「尖り具合」であることを特定できる。 | 歪度の異常は検出できない。 |
| **ダゴスティーノ・ピアソン検定** (Omnibus) | **総合的な正規性の検定** | **モーメント法**：上記の歪度と尖度の検定結果を統合し、総合的に評価する。 | $K^2 = Z_1^2 + Z_2^2$ （カイ二乗分布に従う） | 「歪み」と「尖り」の両面から正規性を評価できる、バランスの取れた手法。 | 専門の検定（シャピロ＝ウィルク）よりは検出力が若干劣ることがある。 |
| **シャピロ＝ウィルク検定** | **高精度な正規性の検定** | **相関法**：ソートした実データと、正規分布から期待される理想値との間の**相関の強さ**を評価する。 | $W$ （1に近いほど正規分布らしい） | **正規性の検定において最も検出力が高い**とされ、多くの場面で第一選択となる「ゴールドスタンダード」。 | 正規性専用であり、他の分布の検定には使えない。 |
| **コルモゴロフ＝スミルノフ検定** (1標本) | **汎用的な分布の適合度検定** | **CDF法**：実データの累積分布（ECDF）と理論分布の累積分布（CDF）の**グラフ間の最も大きな垂直距離**を評価する。  | $D$ （最大垂直距離） | 正規分布だけでなく、**一様分布や指数分布など、あらゆる連続分布**に対する適合度を検定できる。 | 正規性検定としての検出力はシャピロ＝ウィルクに劣る。パラメータをデータから推定するとリリフォース補正が必要。 |


# 各種正規性の検定手法の解説
## 歪度による検定(DAgostino_skewtest)
- **目的**: データの分布が、正規分布の特徴である「左右対称性」を持っているかを評価します。
- **着目点**: **歪度 (Skewness)**。分布が左右どちらに偏っているかを示す指標です。
- 帰無仮説と対立仮説は以下
  - H0: データが従う母集団の分布は正規分布である（つまり、歪度は0である）。
  - H1: データが従う母集団の分布は正規分布ではない（つまり、歪度は0ではない）。
 - **アルゴリズムの要点**:
    1.  データから**標本歪度 ($g_1$)** を計算します。
    2.  D'Agostino (1970) の変換式を用いて、$g_1$ を**標準正規分布 ($N(0,1)$) に従う検定統計量 $Z_1$** へと変換します。
    3.  $Z_1$ の値からp値を算出し、帰無仮説を棄却できるか判断します。
- **対応ライブラリ**: `scipy.stats.skewtest`



## 尖度による検定 (Anscombe-Glynn test)
- **目的**: データの分布が、正規分布の持つ「なだらかな尖り具合」を持っているかを評価します。
- **着目点**: **尖度 (Kurtosis)**。分布のピークがどれだけ鋭いか、または平坦かを示す指標です。
- **帰無仮説**: 「データが従う母集団の分布は正規分布である（尖度は3である）」。
- 帰無仮説と対立仮説は以下
  - H0: データが従う母集団の分布は正規分布である（尖度は3である）。
  - H1: データが従う母集団の分布は正規分布ではない（尖度は3ではない）。
- **アルゴリズムの要点**:
    1.  データから**標本尖度 ($b_2$)** を計算します。
    2.  Anscombe & Glynn (1983) の、より精度の高い変換式を用いて、$b_2$ を**標準正規分布 ($N(0,1)$) に従う検定統計量 $Z_2$** へと変換します。
    3.  $Z_2$ の値からp値を算出し、帰無仮説を棄却できるか判断します。
-   **対応ライブラリ**: `scipy.stats.kurtosistest`



## 歪度と尖度による検定 (D'Agostino-Pearson test)
- **目的**: **「歪み」と「尖り」の両面から**、データの分布が正規分布から逸脱していないかを**同時に評価する**、最も総合的で強力な検定です。
- **着目点**: 歪度と尖度の両方。
- 帰無仮説と対立仮説は以下
  - H0: データが従う母集団の分布は正規分布である。
  - H1: データが従う母集団の分布は正規分布ではない。
-   **アルゴリズムの要点**:
    1.  上記2つの検定から、統計量 $Z_1$（歪度）と $Z_2$（尖度）をそれぞれ求めます。
    2.  両者を2乗して足し合わせ、**検定統計量 $K^2 = Z_1^2 + Z_2^2$** を計算します。この $K^2$ は、**自由度2のカイ二乗分布 ($\chi^2(2)$)** に従います。
    3.  $K^2$ の値とカイ二乗分布からp値を算出し、帰無仮説を棄却できるか判断します。
- **対応ライブラリ**: `scipy.stats.normaltest`



## シャピロ-ウィルク検定(Shapiro-Wilk test)
- **目的**: データが**正規分布**に従うか否かを検定するための、**高精度で検出力が高い**専門的な手法です。
- **着眼点**: **相関法**に基づきます。データを小さい順に並べたものと、正規分布から期待される「理想的な値の並び」が、どれだけ強く直線的な相関関係にあるかを評価します。
- 帰無仮説と対立仮説は以下
  - H0: データは、正規分布に従う母集団から得られたものである。
  - H1: データは、正規分布に従う母集団から得られたものではない。
- **アルゴリズムの要点**:
  1.  ソートしたデータ ($y_i$) と、正規分布の性質から導かれる**係数 ($a_i$)** を準備します。
  2.  **検定統計量 $W = \frac{(\sum a_i y_i)^2}{\sum (y_i - \bar{y})^2}$** を計算します。この値が1に近いほど、データは正規分布に近いと判断されます。
  3.  $W$の値を**Roystonの近似アルゴリズム**で変換し、**標準正規分布 ($N(0,1)$)** に従うZ値を求め、p値を算出します。
- **対応ライブラリ**: `scipy.stats.shapiro`



## コルモゴロフ＝スミルノフ検定 (Kolmogorov-Smirnov test)
- **目的**: データが、指定した特定の連続分布（正規分布、一様分布など）に従うか否かを評価する、**汎用的な適合度検定**です。
- **着眼点**: **CDF法**に基づきます。データの**経験累積分布関数 (ECDF)** と、比較したい理論分布の**累積分布関数 (CDF)** のグラフ間の**最大垂直距離**を評価します。
- 帰無仮説と対立仮説は以下
  - H0: データは、指定された理論分布に従う母集団から得られたものである。
  - H1: データは、指定された理論分布に従う母集団から得られたものではない。
- **アルゴリズムの要点**:
  1.  データから階段状のグラフである**経験累積分布関数 (ECDF)** を作成します。
  2.  ECDFとなめらかな理論分布のCDFを比較し、その**最大垂直距離**を**検定統計量 $D$** として計算します。
  3.  $D$の値とサンプルサイズ $n$ から、**コルモゴロフ分布**を用いてp値を算出します。（※正規性の検定でパラメータをデータから推定した場合は、**リリフォース補正**が必要です）
- **対応ライブラリ**: `scipy.stats.kstest` (リリフォース補正版は`statsmodels.stats.diagnostic.lilliefors`)


# 参考文献
- D'Agostino, R. B.: "Transformation to normality of the null distribution of g1". Biometrika(1970).
- Anscombe, F. J., & Glynn, W. J.: "Distribution of the kurtosis statistic b2 for normal samples". Biometrika(1983).
- D'Agostino, R. B., & Pearson, E. S.: "Tests for departure from normality. Empirical results for the distributions of b2 and √b1", Biometrika(1973).
